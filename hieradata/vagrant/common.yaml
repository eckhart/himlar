---
include:
  default:
    - profile::development::network::dns

# Location setting
location_environment: dev
location_description: Local development environment using vagrant

# Domains
domain_public:          'vagrant.iaas.intern'
domain_trp:             'trp.vagrant.iaas.intern'
domain_mgmt:            'mgmt.vagrant.iaas.intern'

# These should only be used to configure network in nodes!
netcfg_netpart_trp:     '172.31.16'
netcfg_netmask_trp:     '255.255.255.0'
netcfg_netpart_mgmt:    '172.31.0'
netcfg_netmask_mgmt:    '255.255.255.0'
netcfg_gateway_mgmt:    '172.31.0.1'
netcfg_netpart_public:  '172.31.24'
netcfg_netmask_public:  '255.255.255.0'
netcfg_peerdns1:        '172.31.0.1'
netcfg_peerdns2:        '8.8.8.8'
netcfg_domain:          "%{hiera('domain_mgmt')} %{hiera('domain_trp')} %{hiera('domain_public')}"

#
# Networks
# See http://iaas.readthedocs.io/en/latest/installation/ip.html
# For config that require network info about other network
#
network_service:    '172.31.16.0/24'
network_transport:  '172.31.16.0/24'
network_public:     '172.31.24.0/24'

#
# Default interfaces
#
named_interfaces::config:
  vagrant:
    - eth0
  mgmt:
    - eth1
  transport: #FIXME
    - eth2
  trp:
    - eth2
  service: #FIXME
    - eth2
  public:
    - eth3

allow_from_network:
  - '172.31.24.0/24'

endpoint_protocol: 'https'

profile::firewall::pre::ssh_settings:
  source: "0.0.0.0/0"

#
# Openstack services
#

# public
service__address__status:            "status.%{hiera('domain_public')}"
service__address__horizon:           "dashboard.%{hiera('domain_public')}"
service__address__keystone_public:   "dashboard.%{hiera('domain_public')}"
service__address__glance_public_api: "dashboard.%{hiera('domain_public')}"
service__address__nova_public_api:   "dashboard.%{hiera('domain_public')}"
service__address__neutron_public:    "dashboard.%{hiera('domain_public')}"
service__address__cinder_public_api: "dashboard.%{hiera('domain_public')}"
service__address__consoleproxy:      "console.%{hiera('domain_public')}"


# service/transport
# In vagrant default is master. Remove to use nodes from common
service__address__nova_api:          '172.31.16.20'
service__address__nova_api_metadata: '172.31.16.20'
service__address__glance_registry:   '172.31.16.20'
service__address__glance_api:        '172.31.16.20'
service__address__keystone:          '172.31.16.20'
service__address__keystone_admin:    '172.31.16.20'
service__address__etcd_cluster:      '172.31.16.20'
service__address__neutron_server:    '172.31.16.20'
service__address__cinder_api:        '172.31.16.20'
service__address__mysql:             '172.31.16.41'
service__address__rsyslog:           '172.31.0.13'
service__address__proxy:             ''

# Rabbitmq:
# In vagrant default is master
# Remove these to test with mq-01
service__address__rabbitmq_01:       '172.31.16.20'
service__address__rabbitmq_02:       '172.31.16.20'
service__address__rabbitmq_03:       '172.31.16.20'

# no proxy for vagrant environments
profile::network::yum_proxy::yum_proxy: ''

#
#  - Add vagrant user to wheel and users group
#
accounts::users:
  'vagrant':
    comment: 'vagrant system user'
    groups:  [ 'users', 'wheel' ]

sudo::configs:
  requiretty:
    priority: 5
    content: 'Defaults:vagrant !requiretty'
  vagrant:
    priority: 10
    content: 'vagrant ALL=(ALL) NOPASSWD:ALL'

profile::network::services::dns_options:
  CNAME:
    default:
      ttl: 3600
      keyfile: "/etc/rndc.key"
      server: "%{hiera('netcfg_netpart_mgmt')}.11"
  A:
    default:
      ttl: 86400
      keyfile: "/etc/rndc.key"
      server: "%{hiera('netcfg_netpart_mgmt')}.11"

profile::network::services::dns_records:
  CNAME:
    "puppet.%{domain}":                     "%{location}-admin-01.%{domain}"
    "foreman.%{domain}":                    "%{location}-admin-01.%{domain}"
    "repo.%{domain}":                       "%{location}-admin-01.%{domain}"
  A:
    "%{location}-login-01.%{hiera('domain_mgmt')}":       "%{hiera('netcfg_netpart_mgmt')}.10"
    "%{location}-admin-01.%{hiera('domain_mgmt')}":       "%{hiera('netcfg_netpart_mgmt')}.11"
    "%{location}-proxy-01.%{hiera('domain_mgmt')}":       "%{hiera('netcfg_netpart_mgmt')}.12"
    "%{location}-logger-01.%{hiera('domain_mgmt')}":      "%{hiera('netcfg_netpart_mgmt')}.13"
    "%{location}-master-01.%{hiera('domain_mgmt')}":      "%{hiera('netcfg_netpart_mgmt')}.20"
    "%{location}-mq-01.%{hiera('domain_mgmt')}":          "%{hiera('netcfg_netpart_mgmt')}.31"
    "%{location}-mq-02.%{hiera('domain_mgmt')}":          "%{hiera('netcfg_netpart_mgmt')}.32"
    "%{location}-image-01.%{hiera('domain_mgmt')}":       "%{hiera('netcfg_netpart_mgmt')}.36"
    "%{location}-db-01.%{hiera('domain_mgmt')}":          "%{hiera('netcfg_netpart_mgmt')}.41"
    "%{location}-volume-01.%{hiera('domain_mgmt')}":      "%{hiera('netcfg_netpart_mgmt')}.46"
    "%{location}-dashboard-01.%{hiera('domain_mgmt')}":   "%{hiera('netcfg_netpart_mgmt')}.51"
    "%{location}-access-01.%{hiera('domain_mgmt')}":      "%{hiera('netcfg_netpart_mgmt')}.56"
    "%{location}-console-01.%{hiera('domain_mgmt')}":     "%{hiera('netcfg_netpart_mgmt')}.61"
    "%{location}-novvactrl-01.%{hiera('domain_mgmt')}":   "%{hiera('netcfg_netpart_mgmt')}.66"
    "%{location}-network-01.%{hiera('domain_mgmt')}":     "%{hiera('netcfg_netpart_mgmt')}.71"
    "%{location}-identity-01.%{hiera('domain_mgmt')}":    "%{hiera('netcfg_netpart_mgmt')}.81"
    "%{location}-controller-01.%{hiera('domain_mgmt')}":  "%{hiera('netcfg_netpart_mgmt')}.100"
    "%{location}-compute-01.%{hiera('domain_mgmt')}":     "%{hiera('netcfg_netpart_mgmt')}.103"
    "mq01.%{hiera('domain_trp')}":                        "%{hiera('netcfg_netpart_trp')}.31"
    "image.%{hiera('domain_trp')}":                       "%{hiera('netcfg_netpart_trp')}.36"
    "volume.%{hiera('domain_trp')}":                      "%{hiera('netcfg_netpart_trp')}.46"
    "novactrl.%{hiera('domain_trp')}":                    "%{hiera('netcfg_netpart_trp')}.66"
    "network.%{hiera('domain_trp')}":                     "%{hiera('netcfg_netpart_trp')}.71"
    "identity.%{hiera('domain_trp')}":                    "%{hiera('netcfg_netpart_trp')}.81"
    "dashboard.%{hiera('domain_public')}":                "%{hiera('netcfg_netpart_public')}.51"
    "access.%{hiera('domain_public')}":                   "%{hiera('netcfg_netpart_public')}.56"
    "console.%{hiera('domain_public')}":                  "%{hiera('netcfg_netpart_public')}.61"

#
## Secret data which for other environments are stored ooutside of this data tree
#

# ceph.yaml
ceph::profile::params::mon_key:                     'AQATGHJTUCBqIBAA7M2yafV1xctn1pgr3GcKPg=='
client.admin::secret:                               'AQBMGHJTkC8HKhAAJ7NH255wYypgm1oVuV41MA=='
client.bootstrap-osd::secret:                       'AQARG3JTsDDEHhAAVinHPiqvJkUi5Mww/URupw=='
client.bootstrap-mds::secret:                       'AQCztJdSyNb0NBAASA2yPZPuwXeIQnDJ9O8gVw=='
client.glance::secret:                              'AQBGJ8dWKhgcNhAA+VU0GlKHcRLJSsJ8WouuSQ=='
client.volumes::secret:                             'AQA4MPZTOGU0ARAAXH9a0fXxVq0X25n2yPREDw=='
client.cinder::secret:                              'AQBypF1V2JYiChAA2qYbjM6jbXJBMmpXPkvwBg=='

# service user api password
keystone_admin_password:                            'admin_pass'
cinder_api_password:                                'cinder_pass'
glance_api_password:                                'glance_pass'
neutron_api_password:                               'neutron_pass'
nova_api_password:                                  'nova_pass'

# rabbitmq
rabbitmq::default_pass:                             'guest'
rabbitmq::erlang_cookie:                            'Himlardev667'

# cinder.yaml
cinder::db::mysql::password:                        'cinder_pass'
cinder::rabbit_password:                            'cinder_guest'

# foreman.yaml
foreman::admin_password:                            'changeme'

# glance.yaml
glance::db::mysql::password:                        'glance_pass'
#glance::notify::rabbitmq::rabbit_password:          'glance_quest'

# horizon.yaml
horizon::secret_key:                                'horizon_secret'

# keystone.yaml
keystone::db::mysql::password:                      'key_pass'
keystone::admin_token:                              'admintoken'

# master.yaml
rbd_volumes_rbd_secret_uuid:                        'AQBypF1V2JYiChAA2qYbjM6jbXJBMmpXPkvwBg=='

# mysql.yaml
mysql::server::root_password:                       'test123'

# neutron.yaml
neutron::rabbit_password:                           'neutron_guest'
neutron::db::mysql::password:                       'neutron_pass'
neutron::agents::metadata::shared_secret:           'a_secret'

# nova.yaml
nova::db::mysql::password:                          'nova_pass'
nova::db::mysql_api::password:                      'nova_api_pass'
nova::api::neutron_metadata_proxy_shared_secret:    'a_secret'
nova::rabbit_password:                              'nova_quest'

# The root user password: himlardev
accounts::root_user::password:                      '$1$vagrant$z3l/WWbF3HllJk0tnqO3i/'
