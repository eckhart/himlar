---
include:
  default:
    - profile::monitoring::sensu::agent

location_environment:   'test02'
location_description:   'Test environment physically in OSL'

domain_frontend:        'test.iaas.uio.no'
domain_public:          'test.iaas.uio.no'
domain_trp:             'test02.uhdc.no'
domain_mgmt:            'mgmt.test02.uhdc.no'

bgp_as:                 '65536'

netcfg_mgmt_gateway:    '172.28.32.12'
netcfg_mgmt_netpart:    '172.28.32'
netcfg_mgmt_netmask:    '255.255.255.0'
netcfg_trp_gateway:     '172.30.32.1'
netcfg_trp_gateway6:    'fd32::1'
netcfg_trp_netpart:     '172.30.32'
netcfg_trp_netpart6:    'fd32'
netcfg_trp_netmask:     '255.255.255.0'
netcfg_trp_netmask6:    '64'
netcfg_dns_server1:     '129.240.2.3'
netcfg_dns_server2:     '129.240.2.40'
netcfg_dns_search:      "%{hiera('domain_mgmt')} %{hiera('domain_trp')} %{hiera('domain_mgmt')}"
netcfg_public_netpart:  '10.100.200'
netcfg_public_netmask:  '255.255.255.0'

netcfg_priv_gateway:    '172.30.32.26'
netcfg_priv_network:    '10.0.244.0/24'
netcfg_pub_natgw:       '10.100.200.248'
netcfg_trp_rr:
  rr1:
    peer_ipv4: '172.30.32.1'
    peer_ipv6: 'fd32::1'

allow_from_network: # FIXME (public net and mgmt net)
  - '10.100.200.0/24'
  - '172.28.32.0/24'
  - '192.168.122.1/32'

#
# DNS (merge of common and this)
#
profile::network::services::dns_records:
  A:
    # public
    "ns.%{hiera('domain_public')}":                         "%{hiera('netcfg_public_netpart')}.16"
    "api.%{hiera('domain_public')}":                        "%{hiera('netcfg_public_netpart')}.250"
    "identity.api.%{hiera('domain_public')}":               "%{hiera('netcfg_public_netpart')}.250"
    "network.api.%{hiera('domain_public')}":                "%{hiera('netcfg_public_netpart')}.250"
    "image.api.%{hiera('domain_public')}":                  "%{hiera('netcfg_public_netpart')}.250"
    "volume.api.%{hiera('domain_public')}":                 "%{hiera('netcfg_public_netpart')}.250"
    "compute.api.%{hiera('domain_public')}":                "%{hiera('netcfg_public_netpart')}.250"
    "status.%{hiera('domain_public')}":                     "%{hiera('netcfg_public_netpart')}.250"
    "access.%{hiera('domain_public')}":                     "%{hiera('netcfg_public_netpart')}.252"
    "console.%{hiera('domain_public')}":                    "%{hiera('netcfg_public_netpart')}.251"
    "dashboard.%{hiera('domain_public')}":                  "%{hiera('netcfg_public_netpart')}.254"
    "%{::location}-controller-00.%{hiera('domain_mgmt')}":  "%{hiera('netcfg_mgmt_netpart')}.99"
PTR:
    # mgmt
    '1.32.28.172.in-addr.arpa':    "%{::location}-leaf-01.%{hiera('domain_mgmt')}"
    '11.32.28.172.in-addr.arpa':   "%{::location}-admin-01.%{hiera('domain_mgmt')}"
    '12.32.28.172.in-addr.arpa':   "%{::location}-proxy-01.%{hiera('domain_mgmt')}"
    '13.32.28.172.in-addr.arpa':   "%{::location}-logger-01.%{hiera('domain_mgmt')}"
    '14.32.28.172.in-addr.arpa':   "%{::location}-monitor-01.%{hiera('domain_mgmt')}"
    '15.32.28.172.in-addr.arpa':   "%{::location}-builder-01.%{hiera('domain_mgmt')}"
    '16.32.28.172.in-addr.arpa':   "%{::location}-ns-01.%{hiera('domain_mgmt')}"
    '17.32.28.172.in-addr.arpa':   "%{::location}-ns-02.%{hiera('domain_mgmt')}"
    '21.32.28.172.in-addr.arpa':   "%{::location}-status-01.%{hiera('domain_mgmt')}"
    '26.32.28.172.in-addr.arpa':   "%{::location}-nat-01.%{hiera('domain_mgmt')}"
    '31.32.28.172.in-addr.arpa':   "%{::location}-mq-01.%{hiera('domain_mgmt')}"
    '36.32.28.172.in-addr.arpa':   "%{::location}-image-01.%{hiera('domain_mgmt')}"
    '41.32.28.172.in-addr.arpa':   "%{::location}-db-01.%{hiera('domain_mgmt')}"
    '42.32.28.172.in-addr.arpa':   "%{::location}-db-02.%{hiera('domain_mgmt')}"
    '46.32.28.172.in-addr.arpa':   "%{::location}-volume-01.%{hiera('domain_mgmt')}"
    '51.32.28.172.in-addr.arpa':   "%{::location}-dashboard-01.%{hiera('domain_mgmt')}"
    '56.32.28.172.in-addr.arpa':   "%{::location}-access-01.%{hiera('domain_mgmt')}"
    '61.32.28.172.in-addr.arpa':   "%{::location}-console-01.%{hiera('domain_mgmt')}"
    '66.32.28.172.in-addr.arpa':   "%{::location}-novactrl-01.%{hiera('domain_mgmt')}"
    '71.32.28.172.in-addr.arpa':   "%{::location}-network-01.%{hiera('domain_mgmt')}"
    '72.32.28.172.in-addr.arpa':   "%{::location}-network-02.%{hiera('domain_mgmt')}"
    '73.32.28.172.in-addr.arpa':   "%{::location}-network-03.%{hiera('domain_mgmt')}"
    '81.32.28.172.in-addr.arpa':   "%{::location}-identity-01.%{hiera('domain_mgmt')}"
    '86.32.28.172.in-addr.arpa':   "%{::location}-api-01.%{hiera('domain_mgmt')}"
    '91.32.28.172.in-addr.arpa':   "%{::location}-cephmon-01.%{hiera('domain_mgmt')}"
    '92.32.28.172.in-addr.arpa':   "%{::location}-cephmon-02.%{hiera('domain_mgmt')}"
    '93.32.28.172.in-addr.arpa':   "%{::location}-cephmon-03.%{hiera('domain_mgmt')}"
    '99.32.28.172.in-addr.arpa':   "%{::location}-controller-00.%{hiera('domain_mgmt')}"
    '100.32.28.172.in-addr.arpa':  "%{::location}-controller-01.%{hiera('domain_mgmt')}"
    '101.32.28.172.in-addr.arpa':  "%{::location}-controller-02.%{hiera('domain_mgmt')}"
    '102.32.28.172.in-addr.arpa':  "%{::location}-controller-03.%{hiera('domain_mgmt')}"
    '103.32.28.172.in-addr.arpa':  "%{::location}-compute-01.%{hiera('domain_mgmt')}"
    '104.32.28.172.in-addr.arpa':  "%{::location}-compute-02.%{hiera('domain_mgmt')}"
    '105.32.28.172.in-addr.arpa':  "%{::location}-compute-03.%{hiera('domain_mgmt')}"
    '106.32.28.172.in-addr.arpa':  "%{::location}-storage-01.%{hiera('domain_mgmt')}"
    '107.32.28.172.in-addr.arpa':  "%{::location}-storage-02.%{hiera('domain_mgmt')}"
    '108.32.28.172.in-addr.arpa':  "%{::location}-storage-03.%{hiera('domain_mgmt')}"
    '109.32.28.172.in-addr.arpa':  "%{::location}-storage-04.%{hiera('domain_mgmt')}"
    '110.32.28.172.in-addr.arpa':  "%{::location}-storage-05.%{hiera('domain_mgmt')}"
    '111.32.28.172.in-addr.arpa':  "%{::location}-compute-04.%{hiera('domain_mgmt')}"
    '112.32.28.172.in-addr.arpa':  "%{::location}-compute-05.%{hiera('domain_mgmt')}"
    '113.32.28.172.in-addr.arpa':  "%{::location}-compute-06.%{hiera('domain_mgmt')}"
    '114.32.28.172.in-addr.arpa':  "%{::location}-controller-04.%{hiera('domain_mgmt')}"
    '115.32.28.172.in-addr.arpa':  "%{::location}-compute-07.%{hiera('domain_mgmt')}"
    '115.32.28.172.in-addr.arpa':  "%{::location}-name-01.%{hiera('domain_mgmt')}"
    '116.32.28.172.in-addr.arpa':  "%{::location}-compute-08.%{hiera('domain_mgmt')}"
    # public
    '16.200.100.10.in-addr.arpa':   "ns.%{hiera('domain_public')}"
    '250.200.100.10.in-addr.arpa':  "api.%{hiera('domain_public')}"
    '251.200.100.10.in-addr.arpa':  "console.%{hiera('domain_public')}"
    '252.200.100.10.in-addr.arpa':  "access.%{hiera('domain_frontend')}"
    '254.200.100.10.in-addr.arpa':  "dashboard.%{hiera('domain_frontend')}"

ntp::servers:
  - ntp1.uio.no
  - ntp2.uio.no

ceph::profile::params::mon_initial_members:         'test02-cephmon-01, test02-cephmon-02, test02-cephmon-03'
ceph::profile::params::mon_host:                    '172.30.32.91:6789, 172.30.32.92:6789, 172.30.32.93:6789'
ceph::profile::params::cluster_network:             '172.30.32.0/24'
ceph::profile::params::public_network:              '172.30.32.0/24'

profile::openstack::volume::manage_rbd: true
profile::openstack::volume::api::enable_multibackend: true
profile::openstack::compute::hypervisor::manage_libvirt_rbd: true

# If backend != file, you must explicitly define stores in %location/modules/glance.yaml
profile::openstack::image::api::backend: 'rbd'

profile::network::services::dns_options:
  CNAME:
    default:
      ttl: 3600
      keyfile: "/etc/rndc-admin.key"
      server: "%{hiera('netcfg_mgmt_netpart')}.16"
  A:
    default:
      ttl: 3600
      keyfile: "/etc/rndc-admin.key"
      server: "%{hiera('netcfg_mgmt_netpart')}.16"
  PTR:
    default:
      ttl: 3600
      keyfile: "/etc/rndc-admin.key"
      server: "%{hiera('netcfg_mgmt_netpart')}.16"

profile::openstack::resource::networks:
  public:
    name: 'public'
    admin_state_up: true
    shared: true
    tenant_name: 'openstack'
    provider_network_type: 'local'

profile::openstack::resource::subnets:
  public:
    name: 'public'
    cidr: '10.100.200.0/24'
    ip_version: '4'
    allocation_pools:
      - 'start=10.100.200.2,end=10.100.200.245'
    gateway_ip: '10.100.200.1'
    dns_nameservers:
      - '129.240.2.40'
      - '129.240.2.3'
    network_name: 'public'
    tenant_name: 'openstack'
